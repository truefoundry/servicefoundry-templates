version: 1
name: {{service_name}}

build:
    service_build:
        service_type: fast_api_build
        version: {{python_version}}
        service: main.py
        packages: requirements.txt

        build_dir: /tmp
        port: 80
        ignore_patterns: [.garbage.txt]

deploy:
    https_service:
        namespace: ${stage.space}
        port: 80
        cpu: 0.5
        cpu_limit: 0.5
        memory: 512000000
        memory_limit: 1024000000
        instances: ${stage.INSTANCES}
        env:
            NUM_THREADS: 10
        health_check:
            endpoint: ./health
            period_seconds: 10
            initial_delay: 50
        metrics_endpoint: ./metrics

envs:
    dev:
        space: {{space}}
        INSTANCES: 1